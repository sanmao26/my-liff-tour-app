<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover"
    />
    <title>My LIFF App</title>
    <style>
      body { padding: 24px; font-family: sans-serif; }
      button {
        display: none;
        width: 100%;
        padding: 16px 0;
        margin: 8px auto;
      }
    </style>
  </head>
  <body>
    <button id="btnShare" onclick="sendShare()">Share Target Picker</button>
    <button id="btnLogin" onclick="liff.login()">Log In</button>
    <button id="btnLogOut" onclick="logOut()">Log Out</button>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      // === config ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥ ===
      const LIFF_ID = "2006670623-loPapVk3";
      const AUTOSHARE_PARAM = "autoshare=1";
      const LIFF_AUTOSHARE_URL = `https://liff.line.me/${LIFF_ID}?${AUTOSHARE_PARAM}`;

      // --- Flex ‡πÄ‡∏î‡∏¥‡∏° + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° "‡πÅ‡∏ä‡∏£‡πå‡∏ï‡πà‡∏≠" ‡πÉ‡∏ô footer ---
      function buildFlexBubble() {
        return {
          type: "bubble",
          size: "giga",
          hero: {
            type: "image",
            url: "https://i.postimg.cc/RhtqmRHv/SL-31-68.jpg",
            size: "full",
            aspectRatio: "3:4",
            aspectMode: "cover",
            action: {
              type: "uri",
              uri: "https://www.probookingcenter.com/tours/japan"
            }
          },
          footer: {
            type: "box",
            layout: "vertical",
            spacing: "md",
            contents: [
              {
                type: "button",
                style: "primary",
                action: {
                  type: "uri",
                  label: "üîÅ ‡πÅ‡∏ä‡∏£‡πå‡∏ï‡πà‡∏≠",
                  uri: LIFF_AUTOSHARE_URL
                }
              },
              {
                type: "button",
                style: "secondary",
                action: {
                  type: "uri",
                  label: "‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°",
                  uri: "https://www.probookingcenter.com/tours/japan"
                }
              }
            ]
          }
        };
      }

      async function sendShare() {
        // ‡∏Å‡∏±‡∏ô‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏ì‡∏µ‡∏£‡∏±‡∏ô‡∏ö‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å/‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
        if (!liff.isApiAvailable("shareTargetPicker")) {
          // ‡πÄ‡∏õ‡∏¥‡∏î LIFF ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏ó‡∏ô (‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ)
          liff.openWindow({ url: LIFF_AUTOSHARE_URL, external: false });
          return;
        }

        const result = await liff.shareTargetPicker([
          {
            type: "flex",
            altText:
              "‡πÇ‡∏õ‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏£‡∏∏‡πä‡∏õ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡πÑ‡∏°‡πà‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 25-33 ‡∏Ñ‡∏ô ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ - 30 ‡∏ï.‡∏Ñ. 68",
            contents: buildFlexBubble()
          }
        ]);

        if (result) {
          alert(`[${result.status}] Message sent!`);
        } else {
          const [majorVer, minorVer, patchVer] = (liff.getLineVersion() || "").split(".");
          if (minorVer === undefined) {
            alert("ShareTargetPicker was canceled in external browser");
            return;
          }
          if (parseInt(majorVer) >= 10 && parseInt(minorVer) >= 10 && parseInt(patchVer) > 0) {
            alert("ShareTargetPicker was canceled in LINE app");
          }
        }
      }

      function logOut() {
        liff.logout();
        window.location.reload();
      }

      function hasAutoShareParam() {
        return window.location.search.replace("?", "").split("&").includes(AUTOSHARE_PARAM);
      }

      async function main() {
        await liff.init({ liffId: LIFF_ID });

        // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        if (liff.isLoggedIn()) {
          document.getElementById("btnShare").style.display = "block";
          if (!liff.isInClient()) {
            document.getElementById("btnLogOut").style.display = "block";
          }
        } else {
          // ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ?autoshare=1 ‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ autoshare ‡∏ï‡πà‡∏≠
          if (hasAutoShareParam()) {
            liff.login({ redirectUri: window.location.href });
            return; // ‡∏£‡∏≠ redirect ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
          }
          document.getElementById("btnLogin").style.display = "block";
        }

        // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå autoshare ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÅ‡∏ä‡∏£‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        if (liff.isLoggedIn() && liff.isInClient() && hasAutoShareParam()) {
          try {
            await sendShare();
          } catch (e) {
            console.error(e);
          }
        }
      }

      main();
    </script>
  </body>
</html>
