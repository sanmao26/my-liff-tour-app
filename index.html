<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover" />
  <title>My LIFF App</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; padding:24px; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 24px; display: grid; gap: 16px; }
    h1 { margin: 0; font-size: clamp(18px, 4vw, 24px); }
    .card { border: 1px solid #e5e7eb33; border-radius: 14px; padding: 16px; box-shadow: 0 6px 20px #0001; }
    button, a.btn {
      display: none; width: 100%; padding: 14px 16px; border-radius: 12px; border: 0;
      text-align: center; font-weight: 600; text-decoration: none;
    }
    .primary { background: #06c755; color: #fff; }
    .ghost { background: transparent; border: 1px solid #cbd5e1; color: inherit; }
    .hint { opacity: .85; font-size: 14px; word-break: break-word; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Share Target Picker (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô/‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°)</h1>
    <div class="card">
      <button id="btnShare" class="primary">‡πÅ‡∏ä‡∏£‡πå Flex ‡∏ï‡πà‡∏≠</button>
      <button id="btnLogin" class="ghost">Log in</button>
      <button id="btnLogout" class="ghost">Log out</button>
      <a id="openInLine" class="btn primary" href="#" rel="nofollow">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE</a>
      <p id="env" class="hint"></p>
    </div>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    // ===== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ =====
    const LIFF_ID = "2006670623-loPapVk3";     // LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const ALT_TEXT = "‡πÇ‡∏õ‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏£‡∏∏‡πä‡∏õ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡πÑ‡∏°‡πà‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 25‚Äì33 ‡∏Ñ‡∏ô ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ - 30 ‡∏ï.‡∏Ñ. 68";

    // Flex ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ)
    function getFlex() {
      return {
        type: "bubble",
        size: "giga",
        hero: {
          type: "image",
          url: "https://i.postimg.cc/RhtqmRHv/SL-31-68.jpg",
          size: "full",
          aspectRatio: "3:4",
          aspectMode: "cover",
          action: { type: "uri", uri: "https://www.probookingcenter.com/tours/japan" }
        },
        // (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥) ‡πÄ‡∏ï‡∏¥‡∏° body/footers ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
        body: {
          type: "box", layout: "vertical", spacing: "md", contents: [
            { type: "text", text: "‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô ‡∏Ñ‡∏±‡∏ô‡πÑ‡∏ã‚Äì‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡πÇ‡∏ï‚Äì‡πÇ‡∏≠‡∏ã‡∏≤‡∏Å‡πâ‡∏≤", weight: "bold", size: "lg", wrap: true },
            { type: "text", text: "‡πÇ‡∏õ‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏£‡∏∏‡πä‡∏õ 25‚Äì33 ‡∏Ñ‡∏ô ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏î‡∏¥‡∏°", size: "sm", color: "#6b7280", wrap: true }
          ]
        },
        footer: {
          type: "box", layout: "vertical", spacing: "md", contents: [
            { type: "button", style: "primary", color: "#06c755",
              action: { type: "uri", label: "‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°", uri: "https://www.probookingcenter.com/tours/japan" } }
          ]
        }
      };
    }

    // ===== UI helpers =====
    const $ = (id) => document.getElementById(id);
    function show(id, on = true) { $(id).style.display = on ? "block" : "none"; }

    async function shareFlex() {
      if (!liff.isApiAvailable("shareTargetPicker")) {
        alert("‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö shareTargetPicker");
        return;
      }
      try {
        const result = await liff.shareTargetPicker([{ type: "flex", altText: ALT_TEXT, contents: getFlex() }]);
        if (result) {
          alert(`[${result.status}] ‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üéâ`);
        } else {
          // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          alert("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå");
        }
      } catch (err) {
        alert("‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (err?.message || err));
      }
    }

    async function init() {
      try {
        await liff.init({ liffId: LIFF_ID });
      } catch (e) {
        alert("liff.init failed: " + (e?.message || e));
        return;
      }

      const inClient = liff.isInClient();
      const loggedIn = liff.isLoggedIn();
      const ctx = liff.getContext?.() || {};
      $("env").textContent = `inClient=${inClient} | loggedIn=${loggedIn} | context=${ctx.type || "none"}`;

      $("btnShare").onclick  = shareFlex;
      $("btnLogin").onclick  = () => liff.login();
      $("btnLogout").onclick = () => { liff.logout(); location.reload(); };

      if (loggedIn) {
        show("btnShare", true);
        show("btnLogout", !inClient); // ‡∏õ‡∏∏‡πà‡∏° logout ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏≠‡∏Å LINE
      } else {
        show("btnLogin", true);
      }

      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏ô‡∏≠‡∏Å LINE ‚Üí ‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ LINE
      if (!inClient) {
        const jump = `https://liff.line.me/${2006670623-loPapVk3}`;
        $("openInLine").href = jump;
        $("openInLine").style.display = "block";
      }

      // ‡πÇ‡∏´‡∏°‡∏î auto (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å): ‡πÄ‡∏û‡∏¥‡πà‡∏° ?autosend=1 ‡∏ó‡πâ‡∏≤‡∏¢ URL ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏•‡∏¢
      const auto = new URL(location.href).searchParams.get("autosend") === "1";
      if (auto && loggedIn) {
        // ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Share Target Picker ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ gesture ‡∏ö‡∏ô‡∏ö‡∏≤‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡πÅ‡∏ä‡∏£‡πå Flex ‡∏ï‡πà‡∏≠' ‡πÅ‡∏ó‡∏ô
        try { await shareFlex(); } catch (_) {}
      }
    }

    init();
  </script>
</body>
</html>
