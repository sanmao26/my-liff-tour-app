<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover" />
  <title>My LIFF App</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; padding:24px; }
    .wrap{max-width:720px;margin:0 auto;display:grid;gap:16px}
    h1{margin:0;font-size:clamp(18px,4vw,24px)}
    .card{border:1px solid #e5e7eb33;border-radius:14px;padding:16px;box-shadow:0 6px 20px #0001}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    button,a.btn{width:100%;padding:12px 16px;border-radius:12px;border:0;font-weight:600;cursor:pointer;text-decoration:none}
    .primary{background:#06c755;color:#fff}
    .ghost{background:transparent;border:1px solid #cbd5e1}
    .muted{opacity:.85;font-size:14px;word-break:break-word}
    .hide{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>‡πÅ‡∏ä‡∏£‡πå Flex (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏° / ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ä‡∏ï‡∏ô‡∏µ‡πâ)</h1>
    <div class="card">
      <div class="row">
        <button id="btnShare" class="primary hide">‡πÅ‡∏ä‡∏£‡πå Flex (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°)</button>
        <button id="btnSendHere" class="ghost hide">‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äú‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‚Äù ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
        <a id="btnOpenInLine" class="btn primary hide" href="#" rel="nofollow">‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô LINE</a>
        <button id="btnLogin" class="ghost hide">Log In</button>
        <button id="btnLogout" class="ghost hide">Log Out</button>
      </div>
      <p id="env" class="muted"></p>
    </div>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    // ===== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ =====
    const LIFF_ID  = "2006670623-loPapVk3"; // ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const ALT_TEXT = "‡πÇ‡∏õ‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏£‡∏∏‡πä‡∏õ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡πÑ‡∏°‡πà‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 25‚Äì33 ‡∏Ñ‡∏ô ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ - 30 ‡∏ï.‡∏Ñ. 68";

    // Helper
    const $ = (id)=>document.getElementById(id);
    const show = (id,on=true)=>$(id).classList[on?"remove":"add"]("hide");
    const deepLink = () => `https://liff.line.me/${LIFF_ID}`;

    // Flex ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏° body/footer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ preview)
    function getFlex(){
      return {
  "type": "bubble",
  "size": "giga",
  "hero": {
    "type": "image",
    "url": "https://i.postimg.cc/RhtqmRHv/SL-31-68.jpg",
    "size": "full",
    "aspectRatio": "3:4",
    "aspectMode": "cover",
    "action": {
      "type": "uri",
      "uri": "https://www.probookingcenter.com/tours/japan"
    }
  }
}

    async function shareTarget(){
      if (!liff.isApiAvailable("shareTargetPicker")) {
        alert("‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö shareTargetPicker");
        return;
      }
      try{
        const result = await liff.shareTargetPicker([{
          type: "flex", altText: ALT_TEXT, contents: getFlex()
        }]);
        if (result) alert(`[${result.status}] ‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üéâ`);
        // result === null ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      }catch(err){
        alert("‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (err?.message||err));
      }
    }

    async function sendHere(){
      const ctx = liff.getContext?.();
      if (!['group','room','utou'].includes(ctx?.type)) {
        alert("‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äò‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‚Äô");
        return;
      }
      try{
        await liff.sendMessages([{ type: "flex", altText: ALT_TEXT, contents: getFlex() }]);
        alert("‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äò‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‚Äô ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
      }catch(err){
        alert("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (err?.message||err));
      }
    }

    function wireUI(inClient, loggedIn, ctxType){
      $("env").textContent = `‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ä‡∏£‡πå ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`;
      // ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å
      $("btnShare").onclick    = shareTarget;
      $("btnSendHere").onclick = sendHere;
      $("btnLogin").onclick    = ()=> liff.login();
      $("btnLogout").onclick   = ()=> { liff.logout(); location.reload(); };

      if (loggedIn) {
        show("btnShare", true);
        if (!inClient) show("btnLogout", true);
        if (inClient && ['group','room','utou'].includes(ctxType)) show("btnSendHere", true);
      } else {
        show("btnLogin", true);
      }

      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ô‡∏≠‡∏Å LINE ‚Üí ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ LINE
      if (!inClient) {
        $("btnOpenInLine").href = deepLink();
        show("btnOpenInLine", true);
      }
    }

    async function main(){
      try { await liff.init({ liffId: LIFF_ID }); }
      catch(e){ alert("liff.init failed: " + (e?.message||e)); return; }

      const inClient = liff.isInClient();
      const loggedIn = liff.isLoggedIn();
      const ctxType  = liff.getContext?.().type || "none";
      wireUI(inClient, loggedIn, ctxType);

      // (‡∏≠‡∏≠‡∏õ‡∏ä‡∏±‡∏ô) auto ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà ?autosend=1 ‡πÅ‡∏•‡∏∞‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß
      const auto = new URL(location.href).searchParams.get("autosend")==="1";
      if (auto && loggedIn && inClient) {
        try { await shareTarget(); } catch(_) {}
      }
    }
    main();
  </script>
</body>
</html>
